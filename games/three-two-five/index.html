<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="theme-color" content="#1a0a3a">
<title>3-2-5 ‚Äî J4F</title>
<link rel="manifest" href="/manifest.json">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(180deg,#1a0a3a,#0d0520);color:#c0b0e0;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
#app{height:100dvh;overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column;align-items:center;padding:12px 10px 100px}
.title{color:#9b59b6;font-size:26px;font-weight:700;letter-spacing:2px;text-shadow:0 2px 8px rgba(155,89,182,.3)}
.subtitle{color:#806090;font-size:12px;letter-spacing:2px}
.btn{padding:8px 14px;background:rgba(30,10,60,.6);color:#c0b0e0;border:1px solid #7246c8;border-radius:10px;font:600 11px -apple-system,sans-serif;cursor:pointer}
.btn-primary{padding:9px 18px;background:linear-gradient(135deg,#7246c8,#3a1a6b);color:#fff;border:none;border-radius:10px;font:700 13px -apple-system,sans-serif;cursor:pointer;box-shadow:0 4px 12px rgba(114,70,200,.4)}
.card-ui{background:linear-gradient(145deg,#2a1a50,#150e30);border:2px solid #7246c8;border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:12px;cursor:pointer;text-align:left;width:100%}
.error-box{color:#ff6b6b;font-size:12px;font-weight:600;background:rgba(255,50,50,.15);padding:8px 14px;border-radius:8px;border:1px solid rgba(255,50,50,.3);text-align:center;width:100%}
.screen{width:100%;max-width:380px;display:flex;flex-direction:column;align-items:center;gap:10px}
.btn-wa{padding:12px 20px;background:linear-gradient(135deg,#1a5c2e,#0f3d1e);color:#4ade80;border:2px solid #2a8c4a;border-radius:12px;font:700 14px -apple-system,sans-serif;cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;width:100%}
.btn-copy{padding:12px 20px;background:linear-gradient(135deg,#2a1a4a,#1a0e30);color:#b39ddb;border:2px solid #6b45a0;border-radius:12px;font:700 14px -apple-system,sans-serif;cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;width:100%}
.join-input{width:100%;max-width:160px;padding:12px;font:800 24px -apple-system,sans-serif;text-align:center;letter-spacing:8px;background:rgba(0,0,0,.3);color:#9b59b6;border:2px solid #7246c8;border-radius:10px;outline:none;text-transform:uppercase}
.room-code-display{background:rgba(0,0,0,.4);border:3px solid #9b59b6;border-radius:16px;padding:24px 36px;text-align:center}
.room-code-text{color:#9b59b6;font-size:48px;font-weight:800;letter-spacing:12px}
.share-row{display:flex;gap:8px;width:100%;max-width:320px}
.info-box{background:rgba(0,0,0,.3);border:1px solid #7246c8;border-radius:10px;padding:8px 14px;font-size:12px;text-align:center;width:100%}
.rules-box{margin-top:10px;background:rgba(10,5,25,.9);border:1px solid #7246c8;border-radius:12px;padding:12px 14px;max-width:380px;width:100%;font-size:12px;line-height:1.5}
.score-bar{display:flex;justify-content:space-between;align-items:center;width:100%;max-width:380px;margin-bottom:6px}
.score-badge{padding:5px 10px;border-radius:8px;font:700 11px -apple-system,sans-serif;border:2px solid transparent;transition:all .3s}
.score-badge.on{background:linear-gradient(135deg,#7246c8,#3a1a6b);color:#fff;border-color:#9b59b6}
.score-badge.off{background:rgba(30,10,60,.6);color:#c0b0e0}

.playing-card{width:48px;height:68px;border-radius:7px;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:700;cursor:pointer;transition:all .15s;border:2px solid #ddd;flex-shrink:0}
.playing-card.red{color:#cc0000}.playing-card.black{color:#333}
.playing-card.facedown{background:linear-gradient(145deg,#3a1a6b,#1a0a3a);color:transparent;border-color:#7246c8}
.playing-card.selectable{border-color:#ffd93d;box-shadow:0 0 8px rgba(255,217,61,.5)}
.playing-card.selectable:active{transform:scale(.93)}
.playing-card.played{opacity:.3}
.playing-card .card-rank{font-size:14px;line-height:1}.playing-card .card-suit{font-size:15px;line-height:1}
.hand-row{display:flex;gap:3px;flex-wrap:wrap;justify-content:center;margin:4px 0}
.trick-area{display:flex;gap:10px;justify-content:center;margin:10px 0;min-height:80px;align-items:center}
.trick-card{width:56px;height:80px;border-radius:8px;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:700;border:3px solid #ffd93d;box-shadow:0 4px 12px rgba(0,0,0,.3)}
.trick-card.red{color:#cc0000}.trick-card.black{color:#333}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}
@keyframes dotBlink{0%,20%{opacity:0}50%{opacity:1}100%{opacity:0}}
.anim-pulse{animation:pulse 1.5s ease infinite}
</style>
</head>
<body>
<div id="app"></div>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
<script src="/js/firebase-config.js"></script>
<script src="/js/j4f-sdk.js"></script>
<script>
/*
  3-2-5 ‚Äî Classic trick-taking card game (simplified to 2 players + 1 AI)
  - 30 cards used (8,9,10,J,Q,K,A of all suits + 7‚ô†, 7‚ô•)
  - 3 players get 10 cards each (Player 0=5 target, Player 1=3 target, Player 2=2 target)
  - Here: Player 0 = Human (target 5), Player 1 = AI (target 3), Player 2 = AI (target 2)
  - Trump suit chosen by 5-target player
  - Play 10 tricks, win your target to succeed
*/
const GAME_ID="three-two-five";
const SUITS=["‚ô†","‚ô•","‚ô¶","‚ô£"];
const SUIT_COLORS={"‚ô†":"black","‚ô•":"red","‚ô¶":"red","‚ô£":"black"};
const RANK_ORDER={"7":7,"8":8,"9":9,"10":10,"J":11,"Q":12,"K":13,"A":14};

function makeDeck(){
  const d=[];
  const ranks=["8","9","10","J","Q","K","A"];
  SUITS.forEach(s=>ranks.forEach(r=>d.push({r,s})));
  d.push({r:"7",s:"‚ô†"});d.push({r:"7",s:"‚ô•"});
  return d; // 30 cards
}
function shuffle(a){const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]]}return b}

const TARGETS=[5,3,2]; // target tricks for each player

function initGame(){
  const deck=shuffle(makeDeck());
  const hands=[[],[],[]];
  for(let i=0;i<30;i++)hands[i%3].push(deck[i]);
  // Sort hands
  hands.forEach(h=>h.sort((a,b)=>(SUITS.indexOf(a.s)-SUITS.indexOf(b.s))*100+(RANK_ORDER[a.r]-RANK_ORDER[b.r])));
  return{hands,tricks:[0,0,0],trick:[],trickLead:0,cp:0,trump:null,phase:"trump",trickNum:0,gameOver:false,winner:null};
}

const S={screen:"mode",gameMode:null,...initGame(),
  roomCode:"",joinCode:"",myPlayer:0,isOnline:false,opJoined:false,onlineErr:"",
  leavePrompt:false,isLeaving:false,showRules:false,inviteMsg:"",searching:false,searchMsg:"",
  scores:[0,0],round:0,
};
let seenMoveId=0,cancelMatchmake=null;

function resetState(){
  if(cancelMatchmake){cancelMatchmake();cancelMatchmake=null}
  const g=initGame();Object.assign(S,g,{scores:[0,0],round:0,
    gameMode:null,isOnline:false,opJoined:false,roomCode:"",joinCode:"",onlineErr:"",
    leavePrompt:false,isLeaving:false,showRules:false,inviteMsg:"",searching:false,searchMsg:""});
  seenMoveId=0;
}

function setTrump(suit){
  S.trump=suit;S.phase="play";
  if(S.cp!==0)scheduleAI();
  render();
}

function canPlay(card,hand){
  if(S.trick.length===0)return true;
  const leadSuit=S.trick[0].card.s;
  const hasSuit=hand.some(c=>c.s===leadSuit);
  if(hasSuit)return card.s===leadSuit;
  return true; // can play any
}

function playCard(cardIdx){
  if(S.phase!=="play"||S.gameOver)return;
  const player=S.cp;
  if(S.gameMode==="ai"&&player!==0)return;
  const hand=S.hands[player];
  const card=hand[cardIdx];
  if(!canPlay(card,hand))return;

  hand.splice(cardIdx,1);
  S.trick.push({player,card});

  if(S.trick.length===3){
    // Resolve trick
    setTimeout(()=>resolveTrick(),600);
  }else{
    S.cp=(S.cp+1)%3;
    if(S.cp!==0)scheduleAI();
  }
  render();
}

function resolveTrick(){
  const leadSuit=S.trick[0].card.s;
  let winIdx=0,winVal=RANK_ORDER[S.trick[0].card.r],winIsTrump=S.trick[0].card.s===S.trump;

  for(let i=1;i<3;i++){
    const c=S.trick[i].card;
    const isTrump=c.s===S.trump;
    const val=RANK_ORDER[c.r];

    if(isTrump&&!winIsTrump){winIdx=i;winVal=val;winIsTrump=true}
    else if(isTrump&&winIsTrump&&val>winVal){winIdx=i;winVal=val}
    else if(!isTrump&&!winIsTrump&&c.s===leadSuit&&val>winVal){winIdx=i;winVal=val}
  }

  const winner=S.trick[winIdx].player;
  S.tricks[winner]++;
  S.trickNum++;
  S.trick=[];
  S.trickLead=winner;
  S.cp=winner;

  if(S.trickNum>=10){
    S.gameOver=true;S.phase="result";
    // Check if targets met
    const met=S.tricks.map((t,i)=>t>=TARGETS[i]);
    if(met[0])S.winner=0;else S.winner=met[1]?1:2;
    S.scores[0]+=S.tricks[0];
    if(S.gameMode==="ai"){
      J4F.leaderboard.submit(GAME_ID,S.tricks[0]>=5?"win":"loss").catch(()=>{});
    }
  }else{
    if(S.cp!==0)scheduleAI();
  }
  render();
}

function scheduleAI(){
  setTimeout(()=>{
    const player=S.cp;
    const hand=S.hands[player];
    const playable=hand.filter(c=>canPlay(c,hand));
    if(playable.length===0)return;

    // Simple AI: play lowest valid card
    let pick=playable[0];
    if(S.trick.length>0){
      const leadSuit=S.trick[0].card.s;
      const suitCards=playable.filter(c=>c.s===leadSuit);
      if(suitCards.length>0){
        // Play highest of lead suit to try to win
        pick=suitCards.reduce((a,b)=>RANK_ORDER[b.r]>RANK_ORDER[a.r]?b:a);
      }else{
        // Play lowest trump or lowest card
        const trumpCards=playable.filter(c=>c.s===S.trump);
        pick=trumpCards.length>0?trumpCards[0]:playable.reduce((a,b)=>RANK_ORDER[a.r]<RANK_ORDER[b.r]?a:b);
      }
    }else{
      // Leading: play highest non-trump
      const nonTrump=playable.filter(c=>c.s!==S.trump);
      pick=nonTrump.length>0?nonTrump.reduce((a,b)=>RANK_ORDER[b.r]>RANK_ORDER[a.r]?b:a):playable[0];
    }

    const idx=hand.indexOf(pick);
    hand.splice(idx,1);
    S.trick.push({player,card:pick});

    if(S.trick.length===3){
      render();
      setTimeout(()=>resolveTrick(),600);
    }else{
      S.cp=(S.cp+1)%3;
      if(S.cp!==0)scheduleAI();
      else render();
    }
    render();
  },500+Math.random()*300);
}

function newRound(){const g=initGame();Object.assign(S,g);render()}

/* ‚ïê‚ïê‚ïê ONLINE ‚ïê‚ïê‚ïê */
async function createRoom(){S.onlineErr="";try{const g=initGame();Object.assign(S,g);const{code}=await J4F.room.create(GAME_ID,{hands:S.hands,tricks:[0,0,0],cp:0,phase:"trump",gameOver:false});S.roomCode=code;S.myPlayer=0;S.isOnline=true;S.opJoined=false;S.gameMode="online";seenMoveId=0;S.screen="lobby";render();setupHostListener()}catch(e){S.onlineErr="Failed";render()}}
async function joinRoom(codeOverride){S.onlineErr="";const code=(codeOverride||S.joinCode).toUpperCase().trim();if(code.length!==4){S.onlineErr="Enter 4-letter code";render();return}try{const{roomData}=await J4F.room.join(code);S.roomCode=code;S.myPlayer=1;S.isOnline=true;S.opJoined=true;const st=roomData.state||{};if(st.hands)S.hands=st.hands;S.cp=st.cp||0;S.phase=st.phase||"trump";seenMoveId=0;S.gameMode="online";S.screen="game";render();setupGuestListener()}catch(e){S.onlineErr=e.message;render()}}
function searchOnline(){S.searching=true;S.onlineErr="";render();const g=initGame();Object.assign(S,g);cancelMatchmake=J4F.room.matchmake(GAME_ID,{hands:S.hands,tricks:[0,0,0],cp:0,phase:"trump",gameOver:false},(code,player,roomData)=>{cancelMatchmake=null;S.searching=false;S.roomCode=code;S.myPlayer=player;S.isOnline=true;S.gameMode="online";seenMoveId=0;if(player===0){S.opJoined=false;S.screen="lobby";render();setupHostListener()}else{S.opJoined=true;const st=roomData?.state||{};if(st.hands)S.hands=st.hands;S.phase=st.phase||"trump";S.screen="game";render();setupGuestListener()}},(msg)=>{cancelMatchmake=null;S.searching=false;S.onlineErr=msg;S.screen="online";render()})}
function cancelSearch(){if(cancelMatchmake){cancelMatchmake();cancelMatchmake=null}S.searching=false;render()}
function setupHostListener(){J4F.room.onUpdate(data=>{if(S.isLeaving)return;if(!S.opJoined&&data.guest&&data.status==="playing"){S.opJoined=true;S.screen="game";render();return}if(data.moveId>seenMoveId&&data.state){seenMoveId=data.moveId;Object.assign(S,data.state);render()}})}
function setupGuestListener(){J4F.room.onUpdate(data=>{if(S.isLeaving)return;if(data.moveId>seenMoveId&&data.state){seenMoveId=data.moveId;Object.assign(S,data.state);render()}})}
async function leaveOnlineMatchToMode(){if(S.isLeaving)return;S.isLeaving=true;try{await J4F.room.leave()}catch(e){}resetState();S.screen="mode";S.isLeaving=false;render()}
function shareWA(code){J4F.share.whatsapp("üÇ£ Join my 3-2-5 game!\nPlay: "+window.location.origin+"/games/three-two-five/"+(code?"?room="+code:""))}
async function shareCopy(code){const ok=await J4F.share.copy("Join my 3-2-5 game!\n"+window.location.origin+"/games/three-two-five/"+(code?"?room="+code:""));S.inviteMsg=ok?"Copied!":"Failed";render();setTimeout(()=>{S.inviteMsg="";render()},2000)}

/* ‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê */
const app=document.getElementById("app");
function render(){
  if(S.screen==="mode")renderMode();
  else if(S.screen==="online")renderOnline();
  else if(S.screen==="searching")renderSearching();
  else if(S.screen==="lobby")renderLobby();
  else if(S.screen==="game")renderGame();
}

function renderMode(){
  let h=`<div class="screen" style="padding-top:20px">
    <div class="title">üÇ£ ‡ÆÆ‡ØÇ‡Æ£‡ØÅ ‡Æá‡Æ∞‡Æ£‡Øç‡Æü‡ØÅ ‡ÆÖ‡Æû‡Øç‡Æö‡ØÅ</div><div class="subtitle">3 - 2 - 5</div>
    <a href="/" style="color:#9b59b6;font-size:11px;text-decoration:none;margin-bottom:4px">‚Üê J4F Home</a>
    <p style="font-size:13px;text-align:center">Trick-taking card game. Win your target tricks!</p>
    <div class="card-ui" onclick="resetState();S.gameMode='pvp';S.screen='game';Object.assign(S,initGame());render()">
      <div style="font-size:32px">üë•</div><div style="flex:1"><div style="color:#9b59b6;font-weight:700;font-size:15px">Local Play</div><div style="color:#806090;font-size:11px">You + 2 AI opponents</div></div>
    </div>
    <div class="card-ui" style="background:linear-gradient(145deg,#1a3a5c,#0f2840);border-color:#2a6a9c" onclick="S.onlineErr='';S.joinCode='';S.screen='online';render()">
      <div style="font-size:32px">üåê</div><div style="flex:1"><div style="color:#5bc0de;font-weight:700;font-size:15px">Online Multiplayer</div></div>
    </div>
    <div class="card-ui" onclick="resetState();S.gameMode='ai';Object.assign(S,initGame());S.screen='game';render()">
      <div style="font-size:32px">ü§ñ</div><div style="flex:1"><div style="color:#4CAF50;font-weight:700;font-size:15px">Play vs AI</div><div style="color:#806090;font-size:11px">You need 5 tricks to win</div></div>
    </div>
  </div>`;app.innerHTML=h;
}
function renderOnline(){
  let h=`<div class="screen" style="padding-top:20px;justify-content:center">
    <div class="title" style="font-size:24px">üÇ£ 3-2-5</div>
    <button class="card-ui" style="background:linear-gradient(145deg,#1a3a5c,#0f2840);border-color:#2a6a9c" onclick="S.screen='searching';searchOnline()"><div style="font-size:28px">üîç</div><div style="flex:1"><div style="color:#5bc0de;font-weight:700">Search Online</div></div></button>
    <button class="card-ui" style="background:linear-gradient(145deg,#1a4a2a,#0f3018);border-color:#2a8c4a" onclick="createRoom()"><div style="font-size:28px">üë´</div><div style="flex:1"><div style="color:#4ade80;font-weight:700">Send to Friends</div></div></button>
    <div style="color:#7246c8;font-size:11px;letter-spacing:2px;margin:4px">‚îÄ‚îÄ HAVE A CODE? ‚îÄ‚îÄ</div>
    <div style="width:100%;background:rgba(0,0,0,.3);border:2px solid #7246c8;border-radius:14px;padding:14px;display:flex;align-items:center;gap:10px;justify-content:center">
      <input class="join-input" type="text" maxlength="4" placeholder="ABCD" style="max-width:120px;padding:8px;font-size:20px" value="${S.joinCode}" oninput="S.joinCode=this.value.toUpperCase()">
      <button class="btn-primary" onclick="joinRoom()">Join</button>
    </div>
    ${S.onlineErr?`<div class="error-box">‚ö†Ô∏è ${S.onlineErr}</div>`:""}
    <button class="btn" onclick="S.screen='mode';render()">‚Üê Back</button>
  </div>`;app.innerHTML=h;
}
function renderSearching(){app.innerHTML=`<div class="screen" style="padding-top:40px;align-items:center"><div class="title" style="font-size:24px">üÇ£ 3-2-5</div><div style="font-size:48px;margin:20px">üîç</div><p style="color:#5bc0de;font-weight:700">Searching...</p><div class="anim-pulse" style="color:#7ab8d4">Looking for players...</div><button class="btn" style="margin-top:20px" onclick="cancelSearch();S.screen='online';render()">Cancel</button></div>`}
function renderLobby(){app.innerHTML=`<div class="screen" style="padding-top:20px;align-items:center"><div class="title" style="font-size:24px">üÇ£ 3-2-5</div><div class="room-code-display"><div style="color:#806090;font-size:11px;margin-bottom:6px">ROOM CODE</div><div class="room-code-text">${S.roomCode}</div></div><div class="anim-pulse" style="color:#5bc0de;font-size:14px">Waiting for opponent...</div><div class="share-row" style="margin-top:12px"><button class="btn-wa" style="flex:1;padding:10px;font-size:12px" onclick="shareWA('${S.roomCode}')">üí¨ WhatsApp</button><button class="btn-copy" style="flex:1;padding:10px;font-size:12px" onclick="shareCopy('${S.roomCode}')">üìã Copy${S.inviteMsg?" ‚úì":""}</button></div><button class="btn" style="margin-top:12px" onclick="leaveOnlineMatchToMode()">Cancel</button></div>`}

function renderGame(){
  const isAI=S.gameMode==="ai"||S.gameMode==="pvp";

  let statusText="";
  if(S.phase==="trump")statusText="Choose trump suit for this round!";
  else if(S.gameOver){
    statusText=S.tricks[0]>=5?"üéâ You won! Got "+S.tricks[0]+"/5 tricks!":"üò§ You needed 5 tricks, got "+S.tricks[0];
  }else{
    statusText=`Trick ${S.trickNum+1}/10 ¬∑ ${S.cp===0?"Your turn":"AI "+S.cp+" playing..."}`;
  }

  // Trump picker
  let trumpHTML="";
  if(S.phase==="trump"){
    trumpHTML=`<div class="info-box" style="border-color:#ffd93d;padding:16px">
      <p style="font-weight:700;color:#ffd93d;margin-bottom:8px">Choose Trump Suit:</p>
      <div style="display:flex;gap:12px;justify-content:center">
        ${SUITS.map(s=>`<button style="font-size:36px;background:none;border:2px solid #ffd93d;border-radius:12px;padding:10px 14px;cursor:pointer;color:${SUIT_COLORS[s]==="red"?"#cc0000":"#fff"}" onclick="setTrump('${s}')">${s}</button>`).join("")}
      </div>
    </div>`;
  }

  // Current trick
  let trickHTML=`<div class="trick-area">`;
  if(S.trick.length>0){
    S.trick.forEach(t=>{
      const color=SUIT_COLORS[t.card.s];
      trickHTML+=`<div style="text-align:center"><div class="trick-card ${color}"><span class="card-rank" style="font-size:18px">${t.card.r}</span><span class="card-suit" style="font-size:20px">${t.card.s}</span></div><div style="font-size:9px;color:#806090;margin-top:2px">${t.player===0?"You":"AI "+t.player}</div></div>`;
    });
  }else if(S.phase==="play"){
    trickHTML+=`<div style="color:#806090;font-size:12px">Play a card to start the trick</div>`;
  }
  trickHTML+=`</div>`;

  // My hand
  let handHTML=`<div style="text-align:center;font-size:11px;color:#806090;margin:4px">Your Hand (Target: 5 tricks)</div><div class="hand-row">`;
  S.hands[0].forEach((c,i)=>{
    const color=SUIT_COLORS[c.s];
    const canPlayIt=S.phase==="play"&&S.cp===0&&!S.gameOver&&canPlay(c,S.hands[0]);
    handHTML+=`<div class="playing-card ${color}${canPlayIt?" selectable":""}" ${canPlayIt?`onclick="playCard(${i})"`:""}>
      <span class="card-rank">${c.r}</span><span class="card-suit">${c.s}</span></div>`;
  });
  handHTML+=`</div>`;

  // AI hands (face down)
  let aiHTML="";
  for(let p=1;p<=2;p++){
    aiHTML+=`<div style="text-align:center;font-size:10px;color:#806090;margin:2px">AI ${p} (Target: ${TARGETS[p]}) ¬∑ Won: ${S.tricks[p]} ¬∑ ${S.hands[p].length} cards</div>`;
  }

  let h=`
  <div style="display:flex;align-items:center;justify-content:space-between;width:100%;max-width:380px;margin-bottom:4px">
    <div><div class="title" style="font-size:20px">üÇ£ 3-2-5</div><div style="color:#806090;font-size:9px">${S.trump?"Trump: "+S.trump:"Choose trump"} ¬∑ Round ${S.round+1}</div></div>
  </div>
  <div class="score-bar">
    <div class="score-badge on">You: ${S.tricks[0]}/5</div>
    <div class="score-badge off">AI1: ${S.tricks[1]}/3</div>
    <div class="score-badge off">AI2: ${S.tricks[2]}/2</div>
  </div>
  <div class="info-box">${statusText}</div>
  ${trumpHTML}
  ${aiHTML}
  ${trickHTML}
  ${handHTML}
  <div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap;justify-content:center">
    ${S.gameOver?`<button class="btn-primary" onclick="newRound()">New Round</button>`:""}
    <button class="btn" onclick="S.showRules=!S.showRules;render()">${S.showRules?"Hide":"Rules"}</button>
    <button class="btn" onclick="resetState();S.screen='mode';render()">Mode</button>
  </div>
  ${S.showRules?`<div class="rules-box">
    <p style="font-weight:700;color:#9b59b6;margin-bottom:6px">How to Play 3-2-5</p>
    <p style="margin-bottom:5px">30 cards dealt to 3 players (10 each).</p>
    <p style="margin-bottom:5px">You (target 5), AI1 (target 3), AI2 (target 2).</p>
    <p style="margin-bottom:5px">You choose the trump suit. Lead any card to start a trick.</p>
    <p style="margin-bottom:5px">Must follow suit if possible. Highest card of lead suit wins (trump beats all).</p>
    <p>Win at least 5 tricks to succeed!</p>
  </div>`:""}`;
  app.innerHTML=h;
}

(function(){
  const params=new URLSearchParams(window.location.search);
  const roomCode=params.get("room");
  if(roomCode&&roomCode.length===4){S.joinCode=roomCode.toUpperCase();S.screen="online";render();setTimeout(()=>joinRoom(roomCode),500);window.history.replaceState({},"",window.location.pathname);return}
  render();
})();
</script>
</body>
</html>
